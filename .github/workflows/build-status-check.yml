name: âœ”Build Status Check


env:
  PROJECT_NAME: Velaptor
  NET_SDK_VERSION: 6.0.101


on:
  workflow_dispatch:
  pull_request:
    branches:
    - workflow-testing-target
    # TODO: Need to add all of the relevant branches that PRs will merge into
    


jobs:
  Build_Status_Check:
    name: Build Status Check
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v2

    - name: Set Build Config Variable
      run: |
        # If the destination branch that the pull request is merging into is master, do a release build
        if ( "${{ github.base_ref }}" -eq "master") {
            # Save the environment variable
            echo "BUILD_CONFIG=Release" | Out-File -FilePath $Env:GITHUB_ENV -Encoding utf-8 -Append
        } else { # Any other branch than master, do a debug build
            echo "BUILD_CONFIG=Debug" | Out-File -FilePath $Env:GITHUB_ENV -Encoding utf-8 -Append
        }

    - name: Setup .NET SDK
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: ${{ env.NET_SDK_VERSION }}

    - name: Restore Dependencies
      run: dotnet restore "${{ github.workspace }}/${{ env.PROJECT_NAME }}/${{ env.PROJECT_NAME }}.csproj"

  build_main_project:
    name: Build Velaptor
    needs: collect-data
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest]
    uses: KinsonDigital/Infrastructure/.github/workflows/build-csharp-project.yml@v3.1.0-beta
    with:
      project-name: ${{ needs.collect-data.outputs.proj-name }}
      build-config: ${{ needs.collect-data.outputs.build-config }}
      net-sdk-version: ${{ needs.collect-data.outputs.sdk-version }}
      os: ${{ matrix.os }}


  build_test_project:
    name: Build Velaptor Test
    needs: collect-data
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest]
    uses: KinsonDigital/Infrastructure/.github/workflows/build-csharp-project.yml@v3.1.0-beta
    with:
      project-name: ${{ needs.collect-data.outputs.proj-name }}Tests
      build-config: ${{ needs.collect-data.outputs.build-config }}
      net-sdk-version: ${{ needs.collect-data.outputs.sdk-version }}
      os: ${{ matrix.os }}


  build_qa_testing_project:
    name: Build Velaptor QA Testing
    needs: collect-data
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest]
    uses: KinsonDigital/Infrastructure/.github/workflows/build-csharp-project.yml@v3.1.0-beta
    with:
      project-name: ${{ needs.collect-data.outputs.proj-name }}Testing
      build-config: ${{ needs.collect-data.outputs.build-config }}
      net-sdk-version: ${{ needs.collect-data.outputs.sdk-version }}
      os: ${{ matrix.os }}
