name: âœ”Build Status Check


env:
  PROJECT_NAME: Velaptor
  NET_SDK_VERSION: 6.0.300


defaults:
  run:
    shell: pwsh


on:
  workflow_dispatch:
  pull_request:
    branches:
    - workflow-testing-target
    # TODO: Need to add all of the relevant branches that PRs will merge into
    

jobs:
  collect-data:
    name: Collect Check Data
    runs-on: ubuntu-latest
    outputs:
      build-config: ${{ steps.get-build-config.outputs.build-config }}
      sdk-version: ${{ steps.get-sdk-version.outputs.sdk-version }}
      proj-name: ${{ env.PROJECT_NAME }}
    steps:
    - name: Get Build Config
      id: get-build-config
      run: |
        # If the destination branch that the pull request is merging into is the master, do a release build
        if ( "${{ github.base_ref }}" -eq "master") {
          Write-Host "::set-output name=build-config::Release";
        } else { # Any other branch than master, do a debug build
          Write-Host "::set-output name=build-config::Debug";
        }

    - name: Get SDK Version From Environment Variable
      id: get-sdk-version
      run: Write-Host "::set-output name=sdk-version::${{ env.NET_SDK_VERSION }}";


  build_main_project:
    name: Build Velaptor
    needs: collect-data
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest]
    uses: KinsonDigital/Infrastructure/.github/workflows/build-csharp-project.yml@v3.1.0-beta
    with:
      project-name: ${{ needs.collect-data.outputs.proj-name }}
      build-config: ${{ needs.collect-data.outputs.build-config }}
      net-sdk-version: ${{ needs.collect-data.outputs.sdk-version }}
      os: ${{ matrix.os }}


  build_test_project:
    name: Build Velaptor Test
    needs: collect-data
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest]
    uses: KinsonDigital/Infrastructure/.github/workflows/matrix-build-csharp-project.yml@v3.1.0-beta
    with:
      project-name: ${{ needs.collect-data.outputs.proj-name }}Tests
      build-config: ${{ needs.collect-data.outputs.build-config }}
      net-sdk-version: ${{ needs.collect-data.outputs.sdk-version }}
      os: ${{ matrix.os }}


  build_qa_testing_project:
    name: Build Velaptor QA Testing
    needs: collect-data
    strategy:
      matrix:
        os: [windows-latest, ubuntu-latest]
    uses: KinsonDigital/Infrastructure/.github/workflows/matrix-build-csharp-project.yml@v3.1.0-beta
    with:
      project-name: ${{ needs.collect-data.outputs.proj-name }}Testing
      build-config: ${{ needs.collect-data.outputs.build-config }}
      net-sdk-version: ${{ needs.collect-data.outputs.sdk-version }}
      os: ${{ matrix.os }}
