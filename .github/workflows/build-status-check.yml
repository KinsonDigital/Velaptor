name: âœ”Build Status Check


defaults:
  run:
    shell: pwsh


env:
  PROJECT_NAME: Velaptor
  NET_SDK_VERSION: 6.0.101


on:
  workflow_dispatch:
  pull_request:
    branches:
    - master
    - develop
    - release/v*.*.*
    - preview/v*.*.*-preview.*
    - 342-workflow-testing # TODO: DELETE THIS


jobs:
  print_info:
    name: Print Info
    runs-on: ubuntu-latest
    steps:
    - name: Print Info
      run: |
        Write-Host "Trigger Event Type: ${{ github.event_name }}";

        if ("${{ github.event_name }}" -like "pull_request*")
        {
          Write-Host "Pull Request Source Branch: ${{ github.head_ref }}";
          Write-Host "Pull Request Destination Branch: ${{ github.base_ref }}";
        }
        elseif ("${{ github.event_name }}" -eq "workflow_dispatch")
        {
          $branch = "${{ github.ref }}".TrimStart("refs/heads/");
          Write-Host "Manual Trigger Branch: $branch";
        }


  collect_data:
    name: Collect Status Check Data
    runs-on: ubuntu-latest
    outputs:
      proj-name: ${{ env.PROJECT_NAME }}
      build-config: ${{ steps.get-build-config.outputs.build-config }}
      sdk-version: ${{ env.NET_SDK_VERSION }}
    steps:
    - name: Get Build Config
      id: get-build-config
      run: |
        # If the workflow is a master branch for manual runs or pull request changes
        if (("${{ github.ref }}" -like "*heads*" -and "${{ github.ref }}".TrimStart("refs/heads/") -eq "master") -or
            ("${{ github.ref }}" -like "*pull*" -and "${{ github.base_ref }}" -eq "master"))
        {
            Write-Host "::set-output name=build-config::Release";
            Write-Host "Build Config: Release";
        }
        else
        {
            Write-Host "::set-output name=build-config::Debug";
            Write-Host "Build Config: Debug";
        }


  build_main_project:
    name: Build Velaptor
    needs: collect_data
    # strategy:
    #   matrix:
    #     os: [windows-latest, ubuntu-latest]
    uses: KinsonDigital/Infrastructure/.github/workflows/build-csharp-project.yml@v3.1.0-beta
    with:
      project-name: ${{ needs.collect_data.outputs.proj-name }}
      build-config: ${{ needs.collect_data.outputs.build-config }}
      net-sdk-version: ${{ needs.collect_data.outputs.sdk-version }}
      os: "ubuntu-latest" # ${{ matrix.os }}


  # build_test_project:
  #   name: Build Velaptor Test
  #   needs: collect_data
  #   strategy:
  #     matrix:
  #       os: [windows-latest, ubuntu-latest]
  #   uses: KinsonDigital/Infrastructure/.github/workflows/build-csharp-project.yml@v3.1.0-beta
  #   with:
  #     project-name: ${{ needs.collect_data.outputs.proj-name }}Tests
  #     build-config: ${{ needs.collect_data.outputs.build-config }}
  #     net-sdk-version: ${{ needs.collect_data.outputs.sdk-version }}
  #     os: ${{ matrix.os }}


  # build_qa_testing_project:
  #   name: Build Velaptor QA Testing
  #   needs: collect_data
  #   strategy:
  #     matrix:
  #       os: [windows-latest, ubuntu-latest]
  #   uses: KinsonDigital/Infrastructure/.github/workflows/build-csharp-project.yml@v3.1.0-beta
  #   with:
  #     project-name: ${{ needs.collect_data.outputs.proj-name }}Testing
  #     build-config: ${{ needs.collect_data.outputs.build-config }}
  #     net-sdk-version: ${{ needs.collect_data.outputs.sdk-version }}
  #     os: ${{ matrix.os }}
